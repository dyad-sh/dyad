
> dyad@0.36.0-beta.2 test
> vitest run src/__tests__/chat_stream_handlers.test.ts


[1m[46m RUN [49m[22m [36mv3.2.4 [39m[90mC:/Users/sonya/Documents/WebStuff/DyadContrib/dyad-contribution-fork[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould return empty object when no dyad-write tags are found
[22m[39m19:28:49.157 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.164 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould return empty object when no dyad-write tags are found
[22m[39m19:28:49.180 (response_processor)         > mark as approved: hasChanges [33mfalse[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-write tags and create files
[22m[39m19:28:49.183 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.184 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-write tags and create files
[22m[39m19:28:49.187 (response_processor)         > Successfully wrote file: /mock/user/data/path/mock-app-path/src/file1.js

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-write tags and create files
[22m[39m19:28:49.188 (response_processor)         > Successfully committed changes: wrote 1 file(s)

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-write tags and create files
[22m[39m19:28:49.190 (response_processor)         > mark as approved: hasChanges [33mtrue[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould handle file system errors gracefully
[22m[39m19:28:49.201 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.201 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process multiple dyad-write tags and commit all files
[22m[39m19:28:49.208 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.209 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process multiple dyad-write tags and commit all files
[22m[39m19:28:49.211 (response_processor)         > Successfully wrote file: /mock/user/data/path/mock-app-path/src/file1.js
19:28:49.212 (response_processor)         > Successfully wrote file: /mock/user/data/path/mock-app-path/src/utils/file2.js
19:28:49.212 (response_processor)         > Successfully wrote file: /mock/user/data/path/mock-app-path/src/components/Button.tsx

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process multiple dyad-write tags and commit all files
[22m[39m19:28:49.213 (response_processor)         > Successfully committed changes: wrote 3 file(s)

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process multiple dyad-write tags and commit all files
[22m[39m19:28:49.214 (response_processor)         > mark as approved: hasChanges [33mtrue[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-rename tags and rename files
[22m[39m19:28:49.217 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.217 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-rename tags and rename files
[22m[39m19:28:49.219 (response_processor)         > Successfully renamed file: /mock/user/data/path/mock-app-path/src/components/OldComponent.jsx -> /mock/user/data/path/mock-app-path/src/components/NewComponent.jsx

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-rename tags and rename files
[22m[39m19:28:49.220 (response_processor)         > Successfully committed changes: renamed 1 file(s)

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-rename tags and rename files
[22m[39m19:28:49.221 (response_processor)         > mark as approved: hasChanges [33mtrue[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould handle non-existent files during rename gracefully
[22m[39m19:28:49.224 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.225 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould handle non-existent files during rename gracefully
[22m[39m19:28:49.227 (response_processor)         > mark as approved: hasChanges [33mfalse[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-delete tags and delete files
[22m[39m19:28:49.229 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.229 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-delete tags and delete files
[22m[39m19:28:49.231 (response_processor)         > Successfully deleted file: /mock/user/data/path/mock-app-path/src/components/Unused.jsx

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-delete tags and delete files
[22m[39m19:28:49.232 (response_processor)         > Successfully committed changes: deleted 1 file(s)

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process dyad-delete tags and delete files
[22m[39m19:28:49.232 (response_processor)         > mark as approved: hasChanges [33mtrue[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould handle non-existent files during delete gracefully
[22m[39m19:28:49.235 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.236 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould handle non-existent files during delete gracefully
[22m[39m19:28:49.238 (response_processor)         > mark as approved: hasChanges [33mfalse[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process mixed operations (write, rename, delete) in one response
[22m[39m19:28:49.243 (file_uploads_state)         > Cleared file uploads state for chat 1
19:28:49.244 (response_processor)         > processFullResponseActions for chatId [33m1[39m

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process mixed operations (write, rename, delete) in one response
[22m[39m19:28:49.250 (response_processor)         > Successfully deleted file: /mock/user/data/path/mock-app-path/src/components/Unused.jsx

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process mixed operations (write, rename, delete) in one response
[22m[39m19:28:49.251 (response_processor)         > Successfully renamed file: /mock/user/data/path/mock-app-path/src/components/OldComponent.jsx -> /mock/user/data/path/mock-app-path/src/components/RenamedComponent.jsx

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process mixed operations (write, rename, delete) in one response
[22m[39m19:28:49.252 (response_processor)         > Successfully wrote file: /mock/user/data/path/mock-app-path/src/components/NewComponent.jsx

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process mixed operations (write, rename, delete) in one response
[22m[39m19:28:49.253 (response_processor)         > Successfully committed changes: wrote 1 file(s), renamed 1 file(s), deleted 1 file(s)

[90mstdout[2m | src/__tests__/chat_stream_handlers.test.ts[2m > [22m[2mprocessFullResponse[2m > [22m[2mshould process mixed operations (write, rename, delete) in one response
[22m[39m19:28:49.254 (response_processor)         > mark as approved: hasChanges [33mtrue[39m

 [31mÔØ»[39m src/__tests__/chat_stream_handlers.test.ts [2m([22m[2m60 tests[22m[2m | [22m[31m2 failed[39m[2m)[22m[32m 116[2mms[22m[39m
   [32mÔ£ô[39m getDyadAddDependencyTags[2m > [22mshould return an empty array when no dyad-add-dependency tags are found[32m 2[2mms[22m[39m
   [32mÔ£ô[39m getDyadAddDependencyTags[2m > [22mshould return an array of dyad-add-dependency tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadAddDependencyTags[2m > [22mshould return all the packages in the dyad-add-dependency tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadAddDependencyTags[2m > [22mshould return all the packages in the dyad-add-dependency tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadAddDependencyTags[2m > [22mshould return all the packages in multiple dyad-add-dependency tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould return an empty array when no dyad-write tags are found[32m 1[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould return a dyad-write tag[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould strip out code fence (if needed) from a dyad-write tag[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould handle missing description[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould handle extra space[32m 1[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould handle nested tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould handle nested tags after preprocessing[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould handle multiple nested tags after preprocessing[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould handle nested tags in multiple attributes[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadWriteTags[2m > [22mshould return an array of dyad-write tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadRenameTags[2m > [22mshould return an empty array when no dyad-rename tags are found[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadRenameTags[2m > [22mshould return an array of dyad-rename tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadDeleteTags[2m > [22mshould return an empty array when no dyad-delete tags are found[32m 0[2mms[22m[39m
   [32mÔ£ô[39m getDyadDeleteTags[2m > [22mshould return an array of dyad-delete paths[32m 0[2mms[22m[39m
   [32mÔ£ô[39m processFullResponse[2m > [22mshould return empty object when no dyad-write tags are found[32m 28[2mms[22m[39m
[31m   [31m├ù[31m processFullResponse[2m > [22mshould process dyad-write tags and create files[39m[32m 18[2mms[22m[39m
[31m     ÔåÆ expected "spy" to be called with arguments: [ ÔÇª(2) ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   "\\mock\\user\\data\\path\\mock-app-path\\src",[90m
[31m+   "/mock/user/data/path/mock-app-path/src",[90m
[2m    {[22m
[2m      "recursive": true,[22m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m1[22m
[31m[39m
   [32mÔ£ô[39m processFullResponse[2m > [22mshould handle file system errors gracefully[32m 6[2mms[22m[39m
[31m   [31m├ù[31m processFullResponse[2m > [22mshould process multiple dyad-write tags and commit all files[39m[32m 10[2mms[22m[39m
[31m     ÔåÆ expected "spy" to be called with arguments: [ ÔÇª(2) ][90m

Received: 

[1m  1st spy call:

[22m[2m  [[22m
[32m-   "\\mock\\user\\data\\path\\mock-app-path\\src",[90m
[31m+   "/mock/user/data/path/mock-app-path/src",[90m
[2m    {[22m
[2m      "recursive": true,[22m
[2m    },[22m
[2m  ][22m

[1m  2nd spy call:

[22m[2m  [[22m
[32m-   "\\mock\\user\\data\\path\\mock-app-path\\src",[90m
[31m+   "/mock/user/data/path/mock-app-path/src/utils",[90m
[2m    {[22m
[2m      "recursive": true,[22m
[2m    },[22m
[2m  ][22m

[1m  3rd spy call:

[22m[2m  [[22m
[32m-   "\\mock\\user\\data\\path\\mock-app-path\\src",[90m
[31m+   "/mock/user/data/path/mock-app-path/src/components",[90m
[2m    {[22m
[2m      "recursive": true,[22m
[2m    },[22m
[2m  ][22m
[31m[90m

Number of calls: [1m3[22m
[31m[39m
   [32mÔ£ô[39m processFullResponse[2m > [22mshould process dyad-rename tags and rename files[32m 7[2mms[22m[39m
   [32mÔ£ô[39m processFullResponse[2m > [22mshould handle non-existent files during rename gracefully[32m 5[2mms[22m[39m
   [32mÔ£ô[39m processFullResponse[2m > [22mshould process dyad-delete tags and delete files[32m 6[2mms[22m[39m
   [32mÔ£ô[39m processFullResponse[2m > [22mshould handle non-existent files during delete gracefully[32m 7[2mms[22m[39m
   [32mÔ£ô[39m processFullResponse[2m > [22mshould process mixed operations (write, rename, delete) in one response[32m 14[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould return empty string when input is empty[32m 1[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould return the same text when no dyad tags are present[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould remove a single dyad-write tag[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould remove a single dyad-delete tag[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould remove a single dyad-rename tag[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould remove multiple different dyad tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould remove dyad tags with multiline content[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould handle dyad tags with complex attributes[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould remove dyad tags and trim whitespace[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould handle nested content that looks like tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould handle self-closing dyad tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould handle malformed dyad tags gracefully[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould handle dyad tags with special characters in content[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould handle multiple dyad tags of the same type[32m 0[2mms[22m[39m
   [32mÔ£ô[39m removeDyadTags[2m > [22mshould handle dyad tags with custom tag names[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return false when there are no dyad-write tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return false when dyad-write tag is properly closed[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return true when dyad-write tag is not closed[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return false when dyad-write tag with attributes is properly closed[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return true when dyad-write tag with attributes is not closed[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return false when there are multiple closed dyad-write tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return true when the last dyad-write tag is unclosed[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould return false when first tag is unclosed but last tag is closed[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle multiline content correctly[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle multiline unclosed content correctly[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle complex attributes correctly[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle text before and after dyad-write tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle unclosed tag with text after[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle empty dyad-write tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle unclosed empty dyad-write tags[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould focus on the last opening tag when there are mixed states[32m 0[2mms[22m[39m
   [32mÔ£ô[39m hasUnclosedDyadWrite[2m > [22mshould handle tags with special characters in attributes[32m 0[2mms[22m[39m

[2m Test Files [22m [1m[31m1 failed[39m[22m[90m (1)[39m
[2m      Tests [22m [1m[31m2 failed[39m[22m[2m | [22m[1m[32m58 passed[39m[22m[90m (60)[39m
[2m   Start at [22m 19:28:44
[2m   Duration [22m 5.21s[2m (transform 1.29s, setup 0ms, collect 3.61s, tests 116ms, environment 683ms, prepare 288ms)[22m

