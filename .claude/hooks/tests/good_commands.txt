# Commands that should be AUTO-APPROVED by the gh-permission-hook
# Format: one command per line, lines starting with # are comments

# =============================================================================
# READ-ONLY GH COMMANDS
# =============================================================================

# Read-only PR commands
gh pr view 123
gh pr list
gh pr status
gh pr diff 123
gh pr checks 123
gh pr view --json title,body
gh pr view 123 --json number,title,body,state,author
gh pr list --state all --limit 100
gh pr list --author @me

# Read-only issue commands
gh issue view 456
gh issue list
gh issue status
gh issue list --state open --label bug
gh issue view 123 --json title,body,comments

# Read-only repo commands
gh repo view
gh repo view owner/repo
gh repo view owner/repo --json name,description,url

# Read-only run/workflow commands
gh run view 789
gh run list
gh run watch 789
gh run download 789
gh workflow list
gh workflow view test.yml

# Read-only release commands
gh release view v1.0.0
gh release list
gh release download v1.0.0

# Search commands
gh search repos test
gh search issues test
gh search prs test
gh search code "function main"
gh search commits "fix bug"

# Browse and status
gh browse
gh status
gh auth status

# Config read operations
gh config get editor
gh config list

# =============================================================================
# PR MODIFICATION COMMANDS (explicitly allowed)
# =============================================================================

gh pr create --title "Test" --body "Test body"
gh pr edit 123 --title "New title"
gh pr ready 123
gh pr review 123 --approve
gh pr review 123 --comment --body "LGTM"
gh pr review 123 --request-changes --body "Please fix"
gh pr close 123
gh pr merge 123 --squash
gh pr merge 123 --rebase
gh pr merge 123 --merge

# =============================================================================
# ISSUE MODIFICATION COMMANDS (explicitly allowed)
# =============================================================================

gh issue create --title "Test"
gh issue create --title "Bug" --body "Description" --label bug
gh issue edit 123 --title "New title"
gh issue edit 123 --add-label enhancement
gh issue close 123
gh issue reopen 123
gh issue comment 123 --body "Comment"

# =============================================================================
# GH API - READ-ONLY REST ENDPOINTS
# =============================================================================

# Basic GET requests (no method = defaults to GET)
gh api /repos/owner/repo
gh api /repos/owner/repo/pulls
gh api /repos/owner/repo/issues
gh api /repos/owner/repo/commits
gh api /repos/owner/repo/branches
gh api /repos/owner/repo/tags
gh api /repos/owner/repo/releases
gh api /repos/owner/repo/contributors
gh api /repos/owner/repo/collaborators
gh api /repos/owner/repo/comments
gh api /repos/owner/repo/events
gh api /repos/owner/repo/forks
gh api /repos/owner/repo/stargazers
gh api /repos/owner/repo/subscribers
gh api /repos/owner/repo/labels
gh api /repos/owner/repo/milestones
gh api /repos/owner/repo/actions/runs
gh api /repos/owner/repo/actions/workflows

# Without leading slash
gh api repos/owner/repo
gh api repos/owner/repo/pulls
gh api repos/owner/repo/pulls/123
gh api repos/owner/repo/issues/456
gh api repos/owner/repo/pulls/123/comments
gh api repos/owner/repo/pulls/123/reviews
gh api repos/owner/repo/pulls/123/commits
gh api repos/owner/repo/pulls/123/files

# User and org endpoints
gh api /user
gh api /users/octocat
gh api /users/octocat/repos
gh api /orgs/github
gh api /orgs/github/repos
gh api /orgs/github/members

# Explicit GET method - various syntaxes
gh api --method GET /repos/owner/repo
gh api --method=GET /repos/owner/repo
gh api -X GET /repos/owner/repo
gh api -X=GET /repos/owner/repo
gh api --method get /repos/owner/repo
gh api -X get /repos/owner/repo

# With query parameters (ampersands in URLs need quoting to avoid shell interpretation)
gh api '/repos/owner/repo/pulls?state=open'
gh api '/repos/owner/repo/issues?state=all&labels=bug'
gh api '/search/repositories?q=tetris+language:python'

# With pagination
gh api /repos/owner/repo/issues --paginate
gh api /repos/owner/repo/pulls --paginate --jq '.[].title'

# =============================================================================
# GH API - INLINE JQ PROCESSING (--jq flag)
# =============================================================================

gh api /repos/owner/repo --jq '.name'
gh api /repos/owner/repo --jq '.name | ascii_downcase'
gh api /repos/owner/repo/pulls --jq '.[].title'
gh api /repos/owner/repo/pulls --jq '.[] | {number, title, state}'
gh api /repos/owner/repo/pulls --jq '.[] | select(.state == "open")'
gh api /repos/owner/repo/pulls --jq 'map({number: .number, title: .title})'
gh api /repos/owner/repo/issues --jq '[.[] | {number, title, labels: [.labels[].name]}]'
gh api repos/owner/repo/pulls/123/comments --jq '.[] | {path: .path, body: .body}'
gh api /repos/owner/repo/contributors --jq '.[] | "\(.login): \(.contributions)"'
gh api /user/repos --jq '.[] | select(.private == false) | .full_name'

# =============================================================================
# GH API - PIPING TO JQ (external jq command)
# =============================================================================

gh api /repos/owner/repo | jq '.name'
gh api /repos/owner/repo | jq '.description'
gh api /repos/owner/repo/pulls | jq '.[0]'
gh api /repos/owner/repo/pulls | jq 'length'
gh api /repos/owner/repo/pulls | jq '.[] | .title'
gh api /repos/owner/repo/issues | jq '[.[] | select(.state == "open")]'
gh api graphql -f query='query { viewer { login } }' | jq '.data.viewer.login'
gh api graphql -f query='query { viewer { login email } }' | jq '.data'
gh pr view 123 --json title | jq '.title'
gh pr view 123 --json title,body,comments | jq '.comments | length'
gh issue list --json number,title | jq '.[] | select(.number > 100)'

# Complex jq filters with pipes inside single quotes (should be allowed)
gh api /repos/owner/repo/pulls | jq '.[] | {n: .number, t: .title} | select(.n > 10)'
gh api /repos/owner/repo/issues | jq 'map(select(.labels | length > 0)) | .[].title'

# =============================================================================
# GH API GRAPHQL - READ-ONLY QUERIES
# =============================================================================

# Basic queries
gh api graphql -f query="query { viewer { login } }"
gh api graphql -f query='query { viewer { login } }'
gh api graphql -f query='query { viewer { login email name } }'

# Named queries
gh api graphql -f query="query GetViewer { viewer { login } }"
gh api graphql -f query='query GetRepository { repository(owner: "owner", name: "repo") { name } }'

# Repository queries
gh api graphql -f query='query { repository(owner: "owner", name: "repo") { name description url } }'
gh api graphql -f query='query { repository(owner: "owner", name: "repo") { issues(first: 10) { nodes { title } } } }'
gh api graphql -f query='query { repository(owner: "owner", name: "repo") { pullRequests(first: 10, states: OPEN) { nodes { title number } } } }'

# With variables
gh api graphql -f query='query($owner: String!, $repo: String!) { repository(owner: $owner, name: $repo) { name } }' -f owner=octocat -f repo=hello-world
gh api graphql -F owner=octocat -F repo=hello-world -f query='query($owner: String!, $repo: String!) { repository(owner: $owner, name: $repo) { name } }'
gh api graphql -f query='query($pr: Int!) { repository(owner: "owner", name: "repo") { pullRequest(number: $pr) { title } } }' -F pr=123

# Complex queries with nested fields
gh api graphql -f query='query { repository(owner: "owner", name: "repo") { pullRequest(number: 123) { title body author { login } commits(first: 10) { nodes { commit { message } } } } } }'
gh api graphql -f query='query { repository(owner: "owner", name: "repo") { issues(first: 50) { nodes { number title state labels(first: 5) { nodes { name } } } } } }'

# PR review threads query (used by pr-fix:comments)
gh api graphql -f query='query($owner: String!, $repo: String!, $pr: Int!) { repository(owner: $owner, name: $repo) { pullRequest(number: $pr) { reviewThreads(first: 100) { nodes { id isResolved isOutdated path line comments(first: 10) { nodes { id databaseId body author { login } createdAt } } } } } } }' -f owner=owner -f repo=repo -F pr=123

# Search queries
gh api graphql -f query='query { search(query: "repo:owner/repo is:pr is:open", type: ISSUE, first: 10) { nodes { ... on PullRequest { title number } } } }'

# =============================================================================
# GH API GRAPHQL - ALLOWED MUTATIONS
# =============================================================================

# PR review thread mutations (resolve/unresolve)
gh api graphql -f query='mutation { resolveReviewThread(input: {threadId: "123"}) { thread { isResolved } } }'
gh api graphql -f query='mutation { unresolveReviewThread(input: {threadId: "123"}) { thread { isResolved } } }'
gh api graphql -f query='mutation($threadId: ID!) { resolveReviewThread(input: {threadId: $threadId}) { thread { isResolved } } }' -f threadId=PRRT_abc123
gh api graphql -f query="mutation { resolveReviewThread(input: {threadId: \"PRRT_abc123\"}) { thread { isResolved } } }"

# PR review comment mutations
gh api graphql -f query='mutation { addPullRequestReview(input: {pullRequestId: "123", event: COMMENT, body: "LGTM"}) { pullRequestReview { id } } }'
gh api graphql -f query='mutation { addPullRequestReviewComment(input: {pullRequestReviewId: "123", body: "Comment", path: "file.js", line: 10}) { comment { id } } }'

# =============================================================================
# GH API REST - ALLOWED WRITE ENDPOINTS
# =============================================================================

# PR comment replies
gh api repos/owner/repo/pulls/123/comments/456/replies -f body='Reply text'
gh api repos/owner/repo/pulls/123/comments/456/replies -f body="Reply with double quotes"
gh api /repos/owner/repo/pulls/123/comments/456/replies -f body='Another reply'
gh api repos/owner/repo/pulls/999/comments/888/replies --field body='Field syntax reply'

# Issue comments
gh api repos/owner/repo/issues/123/comments -f body='Comment text'
gh api repos/owner/repo/issues/123/comments -f body="Comment with double quotes"
gh api /repos/owner/repo/issues/456/comments -f body='Another comment'
gh api repos/owner/repo/issues/789/comments --field body='Field syntax comment'

# =============================================================================
# COMMANDS WITH ENV VAR PREFIXES
# =============================================================================

GH_TOKEN=xxx gh pr view 123
GH_TOKEN=xxx gh api /repos/owner/repo
GH_TOKEN=secret123 gh api graphql -f query='query { viewer { login } }'
env GH_TOKEN=xxx gh pr list
env GH_TOKEN=xxx gh api /repos/owner/repo
GITHUB_TOKEN=xxx GH_HOST=github.example.com gh api /repos/owner/repo

# =============================================================================
# COMMANDS WITH WRAPPER PREFIXES
# =============================================================================

sudo gh pr view 123
command gh pr list
env gh pr view 123
sudo env GH_TOKEN=xxx gh pr view 123
command env GH_TOKEN=xxx gh api /repos/owner/repo
env GH_TOKEN=xxx gh issue close 123
sudo gh issue close 123
env gh issue close 123
